<!DOCTYPE html>
<html lang='es-AR'>
    <head>
        <meta charset='utf-8'>
        <title> Final Libre Proyecto Informático  </title>
    </head>
    
    <body>
        <h1> Editar información de un desarrollador ya existente </h1>

        <main>
            <label for="buscar-id"><strong>ID del desarrollador a editar:</strong></label>
            <input type="number" id="buscar-id" placeholder="Ej: 1">
            <button id="btn-buscar">Buscar</button>

            <hr>

            <form id="form-editar" style="display: none;">
                <input type="hidden" id="edit-id"> <label>Nombre:</label><br>
                <input type="text" id="edit-name" required><br><br>

                <label>Habilidades (Skills):</label><br>
                <input type="text" id="edit-skills" required><br><br>

                <label>Salario:</label><br>
                <input type="number" id="edit-salary" required><br><br>

                <label>URL del Avatar:</label><br>
                <input type="text" id="edit-avatar" required><br><br>

                <button type="submit">Guardar Cambios</button>
            </form>
            
            <p id="mensaje" style="color: green; font-weight: bold;"></p>
        </main>

        <script>
            const inputBuscarId = document.getElementById('buscar-id');
            const btnBuscar = document.getElementById('btn-buscar');
            const formEditar = document.getElementById('form-editar');
            const mensaje = document.getElementById('mensaje');

            const editId = document.getElementById('edit-id');
            const editName = document.getElementById('edit-name');
            const editSkills = document.getElementById('edit-skills');
            const editSalary = document.getElementById('edit-salary');
            const editAvatar = document.getElementById('edit-avatar');

            btnBuscar.addEventListener('click', () => {
                const idABuscar = inputBuscarId.value;
                if(!idABuscar) return alert("Por favor, ingresá un ID válido.");

                fetch('http://127.0.0.1:5000/desarrolladores')
                    .then(res => res.json())
                    .then(desarrolladores => {
                        const devEncontrado = desarrolladores.find(d => d.id == idABuscar);

                        if (devEncontrado) {
                            editId.value = devEncontrado.id;
                            editName.value = devEncontrado.name;
                            editSkills.value = devEncontrado.skills;
                            editSalary.value = devEncontrado.salary;
                            editAvatar.value = devEncontrado.avatar;

                            formEditar.style.display = 'block';
                            mensaje.innerText = '';
                        } else {
                            formEditar.style.display = 'none';
                            mensaje.innerText = "Desarrollador no encontrado";
                            mensaje.style.color = "red";
                        }
                    })
                    .catch(err => console.error(err));
            });

            // envia datos por PUT
            formEditar.addEventListener('submit', (evento) => {
                evento.preventDefault(); 

                const id = editId.value;
                // armamos el JSON con los nuevos valores
                const datosActualizados = {
                    name: editName.value,
                    skills: editSkills.value,
                    salary: parseInt(editSalary.value), 
                    avatar: editAvatar.value
                };

                // petición PUT a la API
                fetch('http://127.0.0.1:5000/desarrolladores/' + id, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(datosActualizados)
                })
                .then(res => res.json())
                .then(data => {
                    mensaje.style.color = "green";
                    mensaje.innerText = "Desarrollador actualizado";
                    formEditar.style.display = 'none'; 
                    inputBuscarId.value = ''; 
                })
                .catch(err => {
                    console.error(err);
                    mensaje.style.color = "red";
                    mensaje.innerText = "Ocurrió un error al intentar actualizar.";
                });
            });
        </script>
    </body>
</html>